{
    "contents" : "rocJM.JMbayes <-\nfunction (object, newdata, Tstart, Thoriz = NULL, Dt = NULL, idVar = \"id\", \n                           simulate = FALSE, M = 100, ...) {\n    if (!inherits(object, \"JMbayes\"))\n        stop(\"Use only with 'JMbayes' objects.\\n\")\n    if (!is.data.frame(newdata) || nrow(newdata) == 0)\n        stop(\"'newdata' must be a data.frame with more than one rows.\\n\")\n    if (is.null(newdata[[idVar]]))\n        stop(\"'idVar' not in 'newdata'.\\n\")\n    if (is.null(Thoriz) && is.null(Dt))\n        stop(\"either 'Thoriz' or 'Dt' must be non null.\\n\")\n    if (is.null(Thoriz))\n        Thoriz <- Tstart + Dt\n    id <- newdata[[idVar]]\n    id <- match(id, unique(id))\n    TermsT <- object$Terms$termsT\n    SurvT <- model.response(model.frame(TermsT, newdata)) \n    is_counting <- attr(SurvT, \"type\") == \"counting\"\n    Time <- if (is_counting) {\n        ave(SurvT[, 2], id, FUN = function (x) tail(x, 1))\n    } else {\n        SurvT[, 1]\n    }\n    timeVar <- object$timeVar\n    newdata2 <- newdata[Time > Tstart, ]\n    newdata2 <- newdata2[newdata2[[timeVar]] <= Tstart, ]    \n    pi.u.t <- if (is_counting) {\n        survfitJM(object, newdata = newdata2, idVar = idVar, survTimes = Thoriz, \n                  simulate = simulate, M = M, LeftTrunc_var = all.vars(TermsT)[1L])\n    } else {\n        survfitJM(object, newdata = newdata2, idVar = idVar, survTimes = Thoriz, \n                  simulate = simulate, M = M)\n    }\n    pi.u.t <- sapply(pi.u.t$summaries, \"[\", 1, 2)\n    # extract event process information\n    id <- newdata2[[idVar]]\n    SurvT <- model.response(model.frame(TermsT, newdata2)) \n    if (is_counting) {\n        f <- factor(id, levels = unique(id))\n        Time <- tapply(SurvT[, 2], f, tail, 1)\n        event <- tapply(SurvT[, 3], f, tail, 1)\n    } else{\n        Time <- SurvT[!duplicated(id), 1]\n        event <- SurvT[!duplicated(id), 2]\n    }\n    names(Time) <- names(event) <- as.character(unique(id))\n    # subjects who died before Thoriz\n    ind1 <- Time <= Thoriz & event == 1\n    # subjects who were censored in the interval (Tstart, Thoriz)\n    ind2 <- Time <= Thoriz & event == 0\n    ind <- ind1 | ind2\n    if (any(ind2)) {\n        nams <- unique(names(ind2[ind2]))\n        pi2 <- if (is_counting) {\n            survfitJM(object, newdata = newdata2[id %in% nams, ], idVar = idVar, \n                      last.time = Time[nams], survTimes = Thoriz, \n                      simulate = simulate, M = M, LeftTrunc_var = all.vars(TermsT)[1L])\n        } else {\n            survfitJM(object, newdata = newdata2[id %in% nams, ], idVar = idVar, \n                      last.time = Time[nams], survTimes = Thoriz, \n                      simulate = simulate, M = M)\n        }\n        pi2 <- 1 - sapply(pi2$summaries, \"[\", 1, 2)\n        nams2 <- names(ind2[ind2])\n        ind[ind2] <- ind[ind2] * pi2[nams2]\n    }\n    # calculate sensitivity and specificity\n    thrs <- seq(0, 1, length = 101)\n    TP <- colSums(outer(pi.u.t, thrs, \"<\") * c(ind)) / sum(ind)\n    FP <- colSums(outer(pi.u.t, thrs, \"<\") * c(1 - ind)) / sum(1 - ind)\n    Q <- colMeans(outer(pi.u.t, thrs, \"<\"))\n    Q. <- 1 - Q\n    k.1.0 <- (TP - Q) / Q.\n    k.0.0 <- (1 - FP - Q.) / Q\n    P <- mean(ind)\n    P. <- 1 - P\n    k.05.0 <- (P * Q. * k.1.0 + P. * Q * k.0.0) / (P * Q. + P. * Q)\n    out <- list(TP = TP, FP = FP, qSN = k.1.0, qSP = k.0.0, qOverall = k.05.0, \n                thrs = thrs, \n                Tstart = Tstart, Thoriz = Thoriz, nr = length(unique(id)), \n                classObject = class(object), nameObject = deparse(substitute(object)))\n    class(out) <- \"rocJM\"\n    out\n}\n",
    "created" : 1458209406019.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3632184867",
    "id" : "49705064",
    "lastKnownWriteTime" : 1458331848,
    "path" : "C:/Users/Dimitris/Documents/PackagesGitHub/JMbayes/R/rocJM.JMbayes.R",
    "project_path" : "R/rocJM.JMbayes.R",
    "properties" : {
    },
    "relative_order" : 9,
    "source_on_save" : false,
    "type" : "r_source"
}
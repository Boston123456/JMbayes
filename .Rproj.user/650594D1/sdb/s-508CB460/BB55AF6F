{
    "collab_server" : "",
    "contents" : "library(\"JMbayes\")\n\n\nlmeFit <- lme(log(serBilir) ~ ns(year, 2), data = pbc2,\n              random = ~ ns(year, 2) | id)\nsurvFit <- coxph(Surv(years, status2) ~ drug, data = pbc2.id, x = TRUE)\n\njointFit <- jointModelBayes(lmeFit, survFit, timeVar = \"year\")\n\n# we compute marginal log-likelihood contribution for Subject 2\nND <- pbc2[pbc2$id == 2, ] # the data of Subject 2\nmarglogLik(jointFit, newdata = ND)\n\n\nsfun <- function (eta, scale) {x <- rnorm(length(eta), eta, scale); exp(x)}\n# loop over the visits of Patient 2\n\nnn <- nrow(ND)\nres2 <- vector(\"list\", nn)\ntup <- numeric(nn)\n\nfor (i in (seq_len(nn))) {\n    # data up to visit i\n    ND.i <- ND[1:i, ]\n    # conditional survival probabilities\n    sfit <- survfitJM(jointFit, newdata = ND.i)$summaries[[1]]\n    # upper limit of the time interval to search for the optimal time\n    tup[i] <- min(1, max(sfit[sfit[, \"Mean\"] > 0.8, \"times\"] - max(ND.i$years)))\n    # find the optimal time\n    v <- dynInfo(jointFit, newdata = ND.i, Dt = 2, simulateFun = sfun)\n    res2[[i]] <- v$summary\n}\nres2\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ndLongPois <- function (y, eta.y, scale, log = FALSE, data) {\n    dpois(x = y, lambda = exp(eta.y), log = log)}\n\nJM.Pois.CURRENT <- jointModelBayes(glmmFit.Pois, PH.id, timeVar = \"obstime\", \n                                   densLong = dLongPois, \n                                   control = list(n.burnin = 5000, n.adapt = 5000, \n                                                  n.iter = 50000, priorVar = 10000))\n\n\nroc.JM.Pois.CURRENT  <- rocJM(JM.Pois.CURRENT, newdata = tr.j, Tstart = 20, Dt = 5)\nplot(roc.JM.Pois.CURRENT)\n\nauc.JM.Pois.CURRENT <- aucJM(JM.Pois.CURRENT, newdata = tr.j, Tstart = 20, Dt = 5)\nauc.JM.Pois.CURRENT\n\nobject = JM.Pois.CURRENT\nnewdata = choice\nThoriz = NULL\nTstart = 20\nDt = 0.5\nidVar = \"id\"\nsimulate = FALSE\nM = 100\n\nset.seed(100)\nchoice <- tot_2006[tot_2006$id %in% sample(unique(tot_2006$id), size = 2000), ]\n\n\nroc.JM.Pois.CURRENT  <- rocJM(JM.Pois.CURRENT, newdata = choice, Tstart = 20, Dt = 0.5)\nplot(roc.JM.Pois.CURRENT)\n\nauc.JM.Pois.CURRENT <- aucJM(JM.Pois.CURRENT, newdata = choice, Tstart = 20, Dt = 0.5)\nauc.JM.Pois.CURRENT\n\n\njointModelBayes(..., \n                n.iter = 150000L, n.adapt = 5000L, n.thin = 150,\n                knots = c(0.5, 1, 1.5, 2), \n                baseHaz = \"regression-splines\")\n\n\n\n\n\n\n\n\n\n\nlmeFit <- lme(log(serBilir) ~ year * (drug + sex), data = pbc2, random = ~ 1 | id)\nsurvFit <- coxph(Surv(years, status2) ~ age + sex + drug, data = pbc2.id, x = TRUE)\n\njointFit <- jointModelBayes(lmeFit, survFit, timeVar = \"year\")\n\ntf <- function (x, data) {\n    cbind(x, \"sexfemale\" = x * (data$sex == \"female\"), \n          \"drugD-penicil\" = x * (data$drug == \"D-penicil\"))\n}\n\njointFit2 <- update(jointFit, transFun = tf)\nsummary(jointFit2)\n\n\n\n\n",
    "created" : 1458330987900.000,
    "dirty" : true,
    "encoding" : "",
    "folds" : "",
    "hash" : "2400910376",
    "id" : "BB55AF6F",
    "lastKnownWriteTime" : 7011605692497750387,
    "last_content_update" : 1462646194471,
    "path" : null,
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 10,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}